!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){e.exports=n.p+"lang-en.json"},function(e,t,n){e.exports=n.p+"lang-ru.json"},function(e,t,n){e.exports=n.p+"lang-by.json"},function(e,t,n){},function(e,t,n){"use strict";function a(e){return Math.round(1.8*e+32)}function r(e){return Math.round(5/9*(e-32))}n.r(t);class o{constructor(e){this.city=e}static async getGeoCoord(e){const t=await ymaps.geocode(e,{results:1}).then(e=>{const t=e.geoObjects.get(0);return void 0!==t?t.geometry.getCoordinates():t});return void 0!==t&&t}static async getCountry(e){return(await ymaps.geocode(e,{results:1}).then(e=>e)).geoObjects.get(0).properties._data.metaDataProperty.GeocoderMetaData.Address.Components[0].name}}async function c(e){const t=`https://api.timezonedb.com/v2.1/get-time-zone?key=18WHARD25R8O&format=json&by=position&lat=${e[0]}&lng=${e[1]}`,n=(await fetch(t).then(e=>e.json()).then(e=>e)).formatted,a=new Date(n),r=a.getHours(),o=a.getMinutes();let c=(r<10?"0":"")+r;return c+=(o<10?":0":":")+o,c}function i(e){const t=document.createElement("div");t.className="today-weather";const n=document.createElement("h3");n.className="today-weather__city",n.innerHTML=`${e.city}, ${e.country}`;const a=document.createElement("p");a.className="today-weather__date",a.innerHTML=function(e,t){const n=moment();return moment.lang(e),n.format(t)}("ru","dddd, MMMM DD YYYY");const r=document.createElement("p");r.className="today-weather__time",r.innerHTML=e.timezome;const o=document.createElement("div");o.className="today-weather__temp flex-row";const c=document.createElement("img");c.className="today-weather__picture",c.src=e.weather.icon;const i=document.createElement("h2");i.innerHTML=`${e.weather.temp}째`,o.appendChild(c),o.appendChild(i);const s=document.createElement("div");s.className="add-info";const d=document.createElement("p");d.className="feels",d.innerHTML="Feels like: ";const l=document.createElement("span");l.innerHTML=`${e.weather.feels}째`,d.appendChild(l);const m=document.createElement("p");m.className="wind",m.innerHTML="Wind: ";const h=document.createElement("span");h.innerHTML=e.weather.wind,m.appendChild(h),m.innerText+=" m/s";const u=document.createElement("p");u.innerHTML="Humidity: ",u.className="humidity";const p=document.createElement("span");return p.innerHTML=e.weather.humidity,u.appendChild(p),u.innerText+=" %",s.appendChild(d),s.appendChild(m),s.appendChild(u),t.appendChild(n),t.appendChild(a),t.appendChild(r),t.appendChild(o),t.appendChild(s),t}function s(e,t){const n=document.createElement("div");n.className="day";const a=document.createElement("p");a.className="day__header",a.innerHTML=function(e,t,n){const a=moment();return moment.lang(e),a.add(n+1,"days").format(t)}("ru","dddd",t);const r=document.createElement("div");r.className="day__temp flex-row";const o=document.createElement("img");o.className="day__picture",o.src=e.day[t].icon;const c=document.createElement("p");return c.innerHTML=`${e.day[t].temp}째`,r.appendChild(o),r.appendChild(c),n.appendChild(a),n.appendChild(r),n}class d{static renderMap(e){ymaps.ready((function(){new ymaps.Map("map",{center:[e[0],e[1]],zoom:10},{searchControlProvider:"yandex#search"})}))}}var l=n(0),m=n.n(l),h=n(1),u=n.n(h),p=n(2),y=n.n(p);async function g(e,t){const n=`https://translate.yandex.net/api/v1.5/tr.json/translate?key=trnsl.1.1.20191211T144223Z.7a1427617ca5d436.b141f0308516674b1674a282f84cba92b8837d84&lang=${t}&text=${e}`;return(await fetch(n).then(e=>e.json()).then(e=>e)).text[0]}class f{constructor(e,t,n,a,r,o,c,i){this.country=t,this.city=n,this.imageUrl=e,this.date=a,this.weather=r,this.coord=o,this.timezome=c,this.lang=i,this.langMap={}}static initPage(){const e=document.createElement("div");e.className="preloader",e.innerHTML='<div class="b-ico-preloader"></div><div class="spinner"></div>',document.body.appendChild(e);const t=document.createElement("div");t.className="wrap",t.appendChild(function(){const e=document.createElement("header");e.className="header flex-row";const t=document.createElement("div");t.className="left-controls";const n=document.createElement("a");n.className="button update-img";const a=document.createElement("select");a.className="button select-lang";const r=document.createElement("option"),o=document.createElement("option"),c=document.createElement("option");o.innerHTML="ru",r.innerHTML="en",c.innerHTML="be",a.appendChild(r),a.appendChild(o),a.appendChild(c);const i=document.createElement("a");i.className="button button-cel non-right-radius active",i.innerHTML="&#8451;";const s=document.createElement("a");s.className="button button-fareg non-left-radius",s.innerHTML="&#8457;",t.appendChild(n),t.appendChild(a),t.appendChild(i),t.appendChild(s);const d=document.createElement("div");d.className="right-controls";const l=document.createElement("input");l.className="search-input speech-input",l.type="text",l.name="eng-input",l.lang="en",l.placeholder="Search city";const m=document.createElement("a");return m.className="button search non-left-radius",m.innerHTML="Search",d.appendChild(l),d.appendChild(m),e.appendChild(t),e.appendChild(d),e}()),document.body.appendChild(t),function(){if(!("webkitSpeechRecognition"in window))return;const e=document.querySelector(".speech-input");let t,n,a,r;const o=e.nextSibling,c=e.parentNode,i=parseInt(getComputedStyle(e).borderRightWidth,10),s=.8*(e.dataset.buttonsize||e.offsetHeight);let d=e.parentNode;d.classList.contains("si-wrapper")||(d=document.createElement("div"),d.classList.add("si-wrapper"),d.appendChild(c.removeChild(e)),r=!0),t=d.querySelector(".si-btn"),t||(t=document.createElement("button"),t.type="button",t.classList.add("si-btn"),t.textContent="speech input",n=document.createElement("span"),a=document.createElement("span"),n.classList.add("si-mic"),a.classList.add("si-holder"),t.appendChild(n),t.appendChild(a),d.appendChild(t),t.style.cursor="pointer",t.style.top=`${.125*s}px`,t.style.height=t.style.width,t.style.height=`${s}px`,e.style.paddingRight=`${s-i}px`),r&&c.insertBefore(d,o)}()}static clearPage(){const e=document.querySelector(".main");e&&e.remove()}static clearWeather(){const e=document.querySelector(".weather");e&&e.remove()}async changeLang(e){this.langMap=await async function(e){let t;switch(e){case"en":t=m.a;break;case"ru":t=u.a;break;case"be":t=y.a}return await fetch(t).then(e=>e.json())}(e),document.querySelector(".search-input").placeholder=this.langMap.placeholder,document.querySelector(".search").innerHTML=this.langMap.btn;const t=document.querySelector(".today-weather__city"),n=await g(t.innerHTML,e);t.innerHTML=n;const a=document.querySelector(".today-weather__date");a.innerHTML=await g(a.innerHTML,e);let r=document.querySelectorAll(".day__header");return r=Array.prototype.slice.call(r),r.forEach(async t=>{t.innerHTML=await g(t.innerHTML,e)}),document.querySelector(".feels").innerHTML=`${this.langMap.feels} ${this.weather.feels}째`,document.querySelector(".wind").innerHTML=`${this.langMap.wind} ${this.weather.wind} ${this.langMap.windspeed}`,document.querySelector(".humidity").innerHTML=`${this.langMap.humidity} ${this.weather.humidity}%`,document.querySelector(".lat").innerHTML=`${this.langMap.lat} ${this.coord[0]}`,document.querySelector(".lon").innerHTML=`${this.langMap.lon} ${this.coord[1]}`,!0}static refreshBackgroundImg(e){document.querySelector(".wrap").style.backgroundImage=`url(${e})`}static refreshTime(e){document.querySelector(".today-weather__time").innerHTML=e}static renderError(e){f.clearPage(),document.querySelector("header").remove(),document.querySelector(".wrap").remove();const t=document.createElement("div");t.className="error flex-column";const n=document.createElement("h2");n.innerHTML="Something wrong. Please, restart page";const a=document.createElement("p");a.innerHTML=e,t.appendChild(n),t.appendChild(a),document.body.appendChild(t),document.querySelector(".preloader").style.display="none"}renderPage(){f.clearPage();const e=document.querySelector(".wrap");e.style.backgroundImage=`url(${this.imageUrl})`,e.appendChild(this.renderMainBlock()),document.body.appendChild(e),d.renderMap(this.coord),document.querySelector(".preloader").style.display="none"}renderWeather(){f.clearWeather(),document.querySelector(".main").prepend(this.renderWeatherBlock())}renderMainBlock(){const e=document.createElement("main");e.className="main flex-row";const t=document.createElement("div");t.className="location flex-column";const n=document.createElement("div");return n.id="map",t.appendChild(n),t.appendChild(function(e){const t=document.createElement("div");t.className="coord flex-row";const n=document.createElement("p");n.className="lat",n.innerHTML=`Latitude: ${e[0]}`;const a=document.createElement("p");return a.className="lon",a.innerHTML=`Longitude: ${e[1]}`,t.appendChild(n),t.appendChild(a),t}(this.coord)),e.appendChild(this.renderWeatherBlock()),e.appendChild(t),e}renderWeatherBlock(){const e=document.createElement("div");e.className="weather";const t=i(this),n=function(e){const t=document.createElement("div");t.className="three-days flex-row";for(let n=0;n<3;n+=1){const a=s(e,n);t.appendChild(a)}return t}(this.weather);e.appendChild(t),e.appendChild(n);const a=document.createElement("div");a.className="location";const r=document.createElement("div");return r.id="map",a.appendChild(r),e}}n(3);var w=f;function v(e){let t="";try{const n=function(e,t){const n=e+Math.random()*(t+1-e);return Math.floor(n)}(0,e.photos.photo.length-1);t=`https://farm${e.photos.photo[n].farm}.static.flickr.com/${e.photos.photo[n].server}/${e.photos.photo[n].id}_${e.photos.photo[n].secret}_b.jpg`}catch(e){w.renderError(`${e}`)}return t}function M(e){if(e.status>=200&&e.status<300)return e;console.log(` Failute fetch: ${e.statusText}`);const t=new Error(e.statusText);throw t.res=e,t}function C(e,t){w.renderError(`${e} ${t}`)}class b{constructor(e,t){this.keys=e,this.imageUrl="https://farm66.static.flickr.com/65535/48691681313_d11a72d71e_b.jpg",this.country="",this.city="",this.date=new Date,this.timezone="",this.weather={},this.lang=t,this.timezome=""}async getIP(){const e=`https://ipinfo.io/json?token=${this.keys.ipToken}`,t=await fetch(e).then(e=>M(e)).then(e=>e.json()).then(e=>e).catch(e=>C(e,"ipinfo"));t&&(this.country=t.country,this.city=t.city)}async getImage(){const e=b.getCity(this);if(!e)return!1;const{fallout:t}=this.weather,n=`https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=${this.keys.flirckKey}&tags=${e},${t}&tag_mode=all&per_page=50&content_type=1&format=json&nojsoncallback=1`,a=await fetch(n).then(e=>M(e)).then(e=>e.json()).then(e=>e).catch(e=>C(e,"api.flickr"));return"ok"===a.stat&&0!==a.photos.photo.length&&(this.imageUrl=v(a)),this.imageUrl}async getWeather(){const e=b.getCity(this);if(!e)return this.weather.message="City is empty",!1;this.coord=await o.getGeoCoord(e),this.coord&&(this.country=await o.getCountry(this.coord),this.timezome=await c(this.coord),this.city=e);const t=`https://api.openweathermap.org/data/2.5/forecast?lat=${this.coord[0]}&lon=${this.coord[1]}&units=metric&APPID=${this.keys.openweathermapKey}`,n=await fetch(t).then(e=>M(e)).then(e=>e.json()).catch(e=>C(e,"api.openweathermap"));return"404"!==n.cod?this.weather=function(e){const t={};t.icon=`https://openweathermap.org/img/wn/${e.list[0].weather[0].icon}@2x.png`,t.fallout=e.list[0].weather[0].main,t.temp=Math.round(e.list[0].main.temp),t.humidity=e.list[0].main.humidity,t.wind=Math.round(e.list[0].wind.speed),t.feels=Math.round(13.12+.6215*t.temp-11.37*t.wind**.16+.3965*t.temp*t.wind**.16),t.day=[];for(let n=0;n<3;n+=1){const a={};a.icon=`https://openweathermap.org/img/wn/${e.list[n+8].weather[0].icon}@2x.png`,a.temp=Math.round(e.list[n+8].main.temp),t.day.push(a)}return t}(n):this.weather.message=n.message,this.weather}static getQuery(){return document.querySelector(".search-input").value}static getCity(e){let t=b.getQuery();return t||({city:t}=e),t||!1}}class E{constructor(){this.SpeechRecognition={}}startRecognizer(e){let t;if("webkitSpeechRecognition"in window){const n=new webkitSpeechRecognition;this.SpeechRecognition=n,n.lang="ru",n.onresult=async n=>{t=n.results[n.resultIndex];const a=document.querySelector(".speech-input");let r,c=t[0].transcript;-1!==c.indexOf(".")&&(c=c.slice(0,c.length-1)),c=await g(c,"en"),a.value=c,""!==c&&(r=await o.getGeoCoord(c)),r&&await e.reload()},n.onend=()=>{},n.start()}return t}}const L=new class{constructor(){this.keys={ipToken:"98caa5d632d865",unplashAccessKey:"2dbae8af108d75a95a2de95cfc00ccf078729d65a3da4ee33dff81818d2c9c24",openweathermapKey:"892f7c08f21962e4a589349f4dee67e9",translateYandexKey:"trnsl.1.1.20191211T144223Z.7a1427617ca5d436.b141f0308516674b1674a282f84cba92b8837d84",flirckKey:"66ddecf3ddfc4c07a3c7d69bd7b74965"},w.initPage(),this.model={}}async reload(e){const t=new b(this.keys,e);if(await t.getIP(),await t.getWeather(),await t.getImage(),t.city&&(t.city=await g(t.city,"en")),!t.weather.message){this.model=t,new w(t.imageUrl,t.country,t.city,t.date,t.weather,t.coord,t.timezome,t.lang).renderPage()}}async refreshBackImg(){await this.model.getImage(),w.refreshBackgroundImg(this.model.imageUrl)}async refreshTime(){w.refreshTime(await c(this.model.coord))}async changeLlang(){const e=document.querySelector(".select-lang"),t=e.options[e.selectedIndex].value;this.model.lang=t;const n=new w(this.model.imageUrl,this.model.country,this.model.city,this.model.date,this.model.weather,this.model.coord,this.model.timezome,this.model.lang);await n.changeLang(t)}renderTemperature(e){this.model.weather.temp=e(this.model.weather.temp),this.model.weather.feels=e(this.model.weather.feels);for(let t=0;t<3;t+=1)this.model.weather.day[t].temp=e(this.model.weather.day[t].temp);new w(this.model.imageUrl,this.model.country,this.model.city,this.model.date,this.model.weather,this.model.coord,this.model.timezome,this.model.lang).renderWeather(this.model.weather)}},T=document.querySelector(".search-input"),S=document.querySelector(".search"),k=document.querySelector(".update-img"),$=document.querySelector(".button-fareg"),H=document.querySelector(".button-cel"),_=document.querySelector(".select-lang");function x(){H.classList.add("active"),$.classList.remove("active"),_.selectedIndex=0}_.addEventListener("change",()=>{const e=_.options[_.selectedIndex].value;L.changeLlang(e)}),$.addEventListener("click",()=>{$.classList.contains("active")||($.classList.add("active"),H.classList.remove("active"),L.renderTemperature(a))}),H.addEventListener("click",()=>{H.classList.contains("active")||(H.classList.add("active"),$.classList.remove("active"),L.renderTemperature(r))}),k.addEventListener("click",()=>{L.refreshBackImg()}),T.addEventListener("keydown",async e=>{if(13===e.keyCode){x();const e=T.value;let t;""!==e&&(t=await o.getGeoCoord(e)),t&&await L.reload()}}),S.addEventListener("click",async()=>{x();const e=T.value;let t;""!==e&&(t=await o.getGeoCoord(e)),t&&await L.reload()}),window.addEventListener("load",async()=>{const e=document.querySelector(".si-btn");await L.reload(),setInterval(()=>{L.refreshTime.call(L)},3e4),e.addEventListener("click",async e=>{x(),e.preventDefault(),document.querySelector(".speech-input").value="",(new E).startRecognizer(L)},!1)})}]);
//# sourceMappingURL=app.bundle.js.map